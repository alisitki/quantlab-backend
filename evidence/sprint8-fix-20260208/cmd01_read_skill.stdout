---
name: quantlab-evidence-standard
description: Enforce Quantlab's Evidence Pack workflow and strict scope rules. Use when working in Quantlab repos (especially quantlab-backend) where every terminal command must be recorded with /usr/bin/time -v, exit code, and stdout/stderr in fenced log blocks, and when changes must be minimal/semantically exact (no git commands, no refactors, no drive-by formatting).
---

# Quantlab Evidence Standard

## Hard Constraints (Must)

- Do not run `git` commands (no `git status`, no `git diff`, no commits, no branching).
- Do not refactor.
- Keep changes semantically exact:
  - Change only what is required for the request.
  - No drive-by formatting, renames, reordering, or "cleanup".
  - No dependency upgrades unless explicitly requested.
- Produce an **Evidence Pack** for all terminal commands you run:
  - Run commands via `/usr/bin/time -v`.
  - Record the **exit code**.
  - Include **stdout** and **stderr** in fenced log blocks.
  - Keep the **smoke test** phase within **20 minutes** of wall-clock time (pick minimal tests, and use `timeout 20m ...` when appropriate).

## Workflow

### 1. Scope Lock

- Restate the requested change in one sentence.
- List explicit non-goals (anything not requested).
- Choose the smallest viable verification (a smoke test).

### 2. Implement Minimal Change

- Prefer the smallest patch that meets requirements.
- Avoid broad edits (formatting, renames, file moves).

### 3. Evidence Pack While You Work

- For **every** terminal command you execute, capture:
  - the exact command line
  - exit code
  - stdout
  - stderr
  - `/usr/bin/time -v` output

Use the helper script in `scripts/evidence_run.sh` when possible (recommended), or follow the manual pattern below.

### 4. Smoke Test (<= 20 minutes)

- Run the smallest test that meaningfully validates the change.
- Prefer targeted commands over full suites.
- If the command could hang or be long, use `timeout 20m ...`.

## Evidence Pack Output Template (Paste In Final Response)

Include one block per command, in the order executed:

````markdown
## Evidence Pack

### [Label for command 1]
**Command**
```bash
/usr/bin/time -v -- <exact command here>
```
**Exit code**: <N>

**stdout**
```text
...
```

**stderr**
```text
...
```

**/usr/bin/time -v**
```text
...
```
````

## Manual Command Pattern (If Not Using The Script)

When running a command manually, use GNU time with `-o` so the time report is not mixed into stderr:

```bash
mkdir -p evidence
stdout="evidence/stdout.log"
stderr="evidence/stderr.log"
timelog="evidence/time-v.log"

/usr/bin/time -v -o "$timelog" -- <cmd> >"$stdout" 2>"$stderr"
ec=$?
```

Then paste the three logs plus `$ec` into the Evidence Pack.
