   220	
   221	    // Step 2: Prepare streaming dataset (NO row accumulation)
   222	    console.log('[EdgeDiscoveryPipeline] Step 2: Preparing streaming dataset...');
   223	
   224	    const dataset = {
   225	      rows: iteratorFactory(),              // ← Iterator (streaming)
   226	      rowsFactory: iteratorFactory,         // ← Factory for multi-pass
   227	      regimeModel: iteratorFactory.metadata.regimeModel,
   228	      featureNames: iteratorFactory.metadata.featureNames,
   229	      metadata: iteratorFactory.metadata
   230	    };
   231	
   232	    console.log('[EdgeDiscoveryPipeline] Dataset ready (streaming mode)');
   233	    timing('after_load_or_open');
   234	
   235	    // Step 3: Scan for patterns (streaming-compatible)
   236	    console.log('[EdgeDiscoveryPipeline] Step 3: Scanning for patterns...');
   237	    const patterns = await this.scanner.scan(dataset);
   238	    console.log(`[EdgeDiscoveryPipeline] Found ${patterns.length} patterns`);
   239	    timing('after_pattern_scan');
   240	
   241	    if (patterns.length === 0) {
   242	      console.log('[EdgeDiscoveryPipeline] No patterns found. Exiting.');
   243	      timing('early_exit_no_patterns');
   244	      timing('after_stat_tests');
   245	      timing('end');
   246	      return {
   247	        patternsScanned: 0,
   248	        patternsTestedSignificant: 0,
   249	        edgeCandidatesGenerated: 0,
   250	        edgeCandidatesRegistered: 0,
   251	        edges: [],
   252	        rejectedPatterns: [],
   253	        metadata: {
   254	          duration: Date.now() - startTime,
   255	          dataRowCount: dataset.metadata.rowCount || 0,
   256	          regimesUsed: dataset.metadata.regimeK,
   257	          filesLoaded: files.length
   258	        }
   259	      };
   260	    }
   261	
   262	    console.log('[EdgeDiscoveryPipeline] Step 4: Testing patterns for statistical significance...');
   263	    const testResults = this.tester.testBatch(patterns, dataset);
   264	    timing('after_stat_tests');
   265	
   266	    const pairedResults = patterns.map((pattern, i) => ({
   267	      pattern,
   268	      testResult: testResults[i]
   269	    }));
   270	
   271	    const acceptedPatterns = pairedResults.filter(({ testResult }) =>
   272	      testResult.recommendation === 'ACCEPT'
   273	    );
   274	
   275	    const rejectedPatterns = pairedResults
   276	      .filter(({ testResult }) => testResult.recommendation === 'REJECT')
   277	      .map(({ pattern, testResult }) => ({
   278	        pattern,
   279	        reason: `overallScore=${testResult.overallScore.toFixed(2)}`
   280	      }));
   281	
   282	    console.log(`[EdgeDiscoveryPipeline] ${acceptedPatterns.length} patterns passed statistical tests`);
   283	
   284	    if (acceptedPatterns.length === 0) {
   285	      console.log('[EdgeDiscoveryPipeline] No patterns passed tests. Exiting.');
   286	      timing('end');
   287	      return {
   288	        patternsScanned: patterns.length,
   289	        patternsTestedSignificant: 0,
   290	        edgeCandidatesGenerated: 0,
   291	        edgeCandidatesRegistered: 0,
   292	        edges: [],
   293	        rejectedPatterns,
   294	        metadata: {
   295	          duration: Date.now() - startTime,
   296	          dataRowCount: dataset.metadata.rowCount || 0,
   297	          regimesUsed: dataset.metadata.regimeK,
   298	          filesLoaded: files.length
   299	        }
   300	      };
   301	    }
   302	
   303	    console.log('[EdgeDiscoveryPipeline] Step 5: Generating edge candidates...');
   304	
   305	    const limitedAccepted = acceptedPatterns.slice(0, this.maxEdgesPerRun);
   306	    if (limitedAccepted.length < acceptedPatterns.length) {
   307	      console.log(`[EdgeDiscoveryPipeline] Limiting to ${this.maxEdgesPerRun} edges (from ${acceptedPatterns.length})`);
   308	    }
   309	
   310	    const edges = this.generator.generateBatch(limitedAccepted);
   311	    console.log(`[EdgeDiscoveryPipeline] Generated ${edges.length} edge candidates`);
   312	
   313	    let registeredCount = 0;
   314	
   315	    if (this.registry) {
   316	      console.log('[EdgeDiscoveryPipeline] Step 6: Registering edges...');
   317	
   318	      for (const edge of edges) {
   319	        const paired = limitedAccepted.find(p =>
   320	          edge.id.includes(p.pattern.id)
