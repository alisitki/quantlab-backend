174:function resolveDayFiles({ exchange, stream, symbolSlug, date }) {
178:  /** @type {Array<{parquetPath: string, metaCandidates: string[]}>} */
181:      parquetPath: `${curatedDir}/data.parquet`,
182:      metaCandidates: [`${curatedDir}/meta.json`, `${curatedDir}/data.parquet.meta.json`]
185:      parquetPath: `${legacyDir}/data.parquet`,
186:      metaCandidates: [`${legacyDir}/meta.json`, `${legacyDir}/data.parquet.meta.json`]
189:      parquetPath: `data/test/${symbolSlug}_${date}.parquet`,
190:      metaCandidates: [
191:        `data/test/${symbolSlug}_${date}_meta.json`,
192:        `data/test/${symbolSlug}_${date}.parquet.meta.json`
196:      parquetPath: `data/sprint2/${symbolSlug}_${date}.parquet`,
197:      metaCandidates: [
198:        `data/sprint2/${symbolSlug}_${date}_meta.json`,
199:        `data/sprint2/${symbolSlug}_${date}.parquet.meta.json`
203:      parquetPath: `data/${symbolSlug}_${date}.parquet`,
204:      metaCandidates: [`data/${symbolSlug}_${date}_meta.json`, `data/${symbolSlug}_${date}.parquet.meta.json`]
209:    if (!existsSync(c.parquetPath)) continue;
210:    for (const metaPath of c.metaCandidates) {
211:      if (existsSync(metaPath)) {
212:        return { parquetPath: c.parquetPath, metaPath };
339:  // Resolve parquet/meta paths for each day
342:  /** @type {Array<{date: string, parquetPath: string, metaPath: string, meta: any}>} */
343:  const resolved = [];
346:    const found = resolveDayFiles({ exchange, stream, symbolSlug, date });
350:      console.error(`[Dataset] Tried patterns (first existing parquet wins, requires meta):`);
351:      console.error(`  data/curated/exchange=${exchange}/stream=${stream}/symbol=${symbolSlug}/date=${date}/data.parquet + meta.json`);
352:      console.error(`  data/exchange=${exchange}/stream=${stream}/symbol=${symbolSlug}/date=${date}/data.parquet + meta.json`);
353:      console.error(`  data/test/${symbolSlug}_${date}.parquet + ${symbolSlug}_${date}_meta.json`);
354:      console.error(`  data/sprint2/${symbolSlug}_${date}.parquet + ${symbolSlug}_${date}_meta.json`);
355:      console.error(`  data/${symbolSlug}_${date}.parquet + ${symbolSlug}_${date}_meta.json`);
359:    const meta = await readJSON(found.metaPath);
360:    if (meta && typeof meta.stream_type === 'string' && meta.stream_type !== stream) {
361:      fatal(`Meta stream_type mismatch for date=${date}: meta.stream_type=${meta.stream_type} != --stream=${stream}`, 2);
364:    resolved.push({ date, parquetPath: found.parquetPath, metaPath: found.metaPath, meta });
368:      console.log(`[Dataset] progress ${n}/${dates.length}: date=${date} parquet=${path.basename(found.parquetPath)} meta=${path.basename(found.metaPath)}`);
372:  // Total rows from meta (best-effort; does not affect pipeline).
373:  const totalRows = resolved.reduce((acc, r) => acc + (Number.isFinite(r.meta?.rows) ? r.meta.rows : 0), 0);
374:  console.log(`[Dataset] resolved ${resolved.length} day(s); meta.rows_total=${totalRows || 'N/A'}`);
375:  checkpoint('t_resolve_files_done');
384:  const files = resolved.map(r => ({ parquetPath: r.parquetPath, metaPath: r.metaPath }));
423:  console.log(`metadata.dataRowCount:     ${result.metadata?.dataRowCount ?? 'N/A'}`);
424:  console.log(`metadata.regimesUsed:      ${result.metadata?.regimesUsed ?? 'N/A'}`);
425:  console.log(`metadata.filesLoaded:      ${result.metadata?.filesLoaded ?? files.length}`);
436:    existsSync('data/test/adausdt_20260204.parquet') &&
437:    existsSync('data/test/adausdt_20260204_meta.json')
440:      'artifact_created_for_diag: data/test/adausdt_20260204.parquet + data/test/adausdt_20260204_meta.json (pre-existing)'
470:    files: resolved.map(r => ({
472:      parquetPath: r.parquetPath,
473:      metaPath: r.metaPath,
474:      meta: {
475:        rows: r.meta?.rows,
476:        schema_version: r.meta?.schema_version,
477:        stream_type: r.meta?.stream_type,
478:        day_quality: r.meta?.day_quality,
479:        sha256: r.meta?.sha256
482:    metaRowsTotal: totalRows || null,
493:      metadata: {
